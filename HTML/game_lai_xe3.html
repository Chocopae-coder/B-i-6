<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Car Obstacle Game</title>
<style>
    body { margin: 0; overflow: hidden; background: #222; }
    canvas { display: block; margin: auto; background: #333; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="400"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const car = {
    x: canvas.width / 2 - 20,
    y: canvas.height - 60,
    width: 40,
    height: 50,
    speed: 5
};

let obstacles = [];
let score = 0;
let gameOver = false;
let obstacleSpeed = 2;
let spawnInterval = 1500; // 1.5 giây
let lastSpawn = Date.now();

const keys = {
    ArrowUp: false,
    ArrowDown: false,
    ArrowLeft: false,
    ArrowRight: false
};

// Tạo chướng ngại vật mới
function spawnObstacle() {
    const size = Math.random() * 30 + 20;
    const x = Math.random() * (canvas.width - size);
    obstacles.push({
        x: x,
        y: -size,
        width: size,
        height: size,
        passed: false
    });
}

// Kiểm tra va chạm
function isColliding(a, b) {
    return !(
        a.x + a.width < b.x ||
        a.x > b.x + b.width ||
        a.y + a.height < b.y ||
        a.y > b.y + b.height
    );
}

// Vẽ xe
function drawCar() {
    ctx.fillStyle = 'red';
    ctx.fillRect(car.x, car.y, car.width, car.height);
}

// Vẽ chướng ngại vật
function drawObstacles() {
    ctx.fillStyle = 'gray';
    obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.width, o.height));
}

// Vẽ điểm số
function drawScore() {
    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText('Score: ' + score, 10, 30);
}

// Cập nhật xe
function updateCar() {
    if (keys.ArrowUp && car.y > 0) car.y -= car.speed;
    if (keys.ArrowDown && car.y + car.height < canvas.height) car.y += car.speed;
    if (keys.ArrowLeft && car.x > 0) car.x -= car.speed;
    if (keys.ArrowRight && car.x + car.width < canvas.width) car.x += car.speed;
}

// Cập nhật chướng ngại vật
function updateObstacles() {
    const now = Date.now();
    if (now - lastSpawn > spawnInterval) {
        spawnObstacle();
        lastSpawn = now;
        // Tăng tốc độ sau mỗi lần spawn để game khó dần
        obstacleSpeed += 0.1;
        if (spawnInterval > 500) spawnInterval -= 20; // spawn nhanh hơn
    }

    obstacles.forEach(o => {
        o.y += obstacleSpeed;

        // Tăng điểm nếu xe đi qua
        if (!o.passed && o.y > car.y + car.height) {
            score += 1;
            o.passed = true;
        }

        if (isColliding(car, o)) {
            gameOver = true;
        }
    });

    // Loại bỏ chướng ngại vật ra khỏi canvas
    obstacles = obstacles.filter(o => o.y < canvas.height + 50);
}

// Vòng lặp game
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!gameOver) {
        updateCar();
        updateObstacles();
        drawCar();
        drawObstacles();
        drawScore();
        requestAnimationFrame(gameLoop);
    } else {
        ctx.fillStyle = 'white';
        ctx.font = '40px Arial';
        ctx.fillText('Game Over!', canvas.width / 2 - 120, canvas.height / 2);
        ctx.fillText('Score: ' + score, canvas.width / 2 - 80, canvas.height / 2 + 50);
    }
}

// Sự kiện bàn phím
document.addEventListener('keydown', e => {
    if (keys.hasOwnProperty(e.key)) keys[e.key] = true;
});
document.addEventListener('keyup', e => {
    if (keys.hasOwnProperty(e.key)) keys[e.key] = false;
});

// Bắt đầu game
gameLoop();
</script>
</body>
</html>